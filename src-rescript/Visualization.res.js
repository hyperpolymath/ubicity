// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Mapper from "./Mapper.res.js";
import * as Core__Array from "@rescript/core/src/Core__Array.res.js";
import * as Core__Option from "@rescript/core/src/Core__Option.res.js";
import * as Core__Promise from "@rescript/core/src/Core__Promise.res.js";

var defaultOptions = {
  outputFile: "ubicity-map.html",
  includeMap: true,
  includeTimeline: true,
  includeNetwork: true
};

function generateCSS() {
  return "\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      background: #f5f5f5;\n      color: #333;\n    }\n\n    header {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 2rem;\n      text-align: center;\n      box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n    }\n\n    header h1 {\n      font-size: 2.5rem;\n      margin-bottom: 0.5rem;\n    }\n\n    header p {\n      opacity: 0.9;\n      font-size: 1.1rem;\n    }\n\n    .container {\n      max-width: 1200px;\n      margin: 2rem auto;\n      padding: 0 1rem;\n    }\n\n    .stats {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n      gap: 1rem;\n      margin-bottom: 2rem;\n    }\n\n    .stat-card {\n      background: white;\n      padding: 1.5rem;\n      border-radius: 8px;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      text-align: center;\n    }\n\n    .stat-value {\n      font-size: 2.5rem;\n      font-weight: bold;\n      color: #667eea;\n      margin-bottom: 0.5rem;\n    }\n\n    .stat-label {\n      color: #666;\n      font-size: 0.9rem;\n      text-transform: uppercase;\n      letter-spacing: 0.5px;\n    }\n\n    .section {\n      background: white;\n      border-radius: 8px;\n      padding: 2rem;\n      margin-bottom: 2rem;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n    }\n\n    .section h2 {\n      color: #667eea;\n      margin-bottom: 1.5rem;\n      font-size: 1.8rem;\n    }\n\n    .search-bar {\n      width: 100%;\n      padding: 0.75rem;\n      font-size: 1rem;\n      border: 2px solid #ddd;\n      border-radius: 4px;\n      margin-bottom: 1rem;\n      transition: border-color 0.3s;\n    }\n\n    .search-bar:focus {\n      outline: none;\n      border-color: #667eea;\n    }\n\n    .filters {\n      display: flex;\n      gap: 0.5rem;\n      flex-wrap: wrap;\n      margin-bottom: 1rem;\n    }\n\n    .filter-tag {\n      padding: 0.5rem 1rem;\n      background: #f0f0f0;\n      border: 1px solid #ddd;\n      border-radius: 20px;\n      cursor: pointer;\n      transition: all 0.3s;\n      font-size: 0.9rem;\n    }\n\n    .filter-tag:hover {\n      background: #e0e0e0;\n    }\n\n    .filter-tag.active {\n      background: #667eea;\n      color: white;\n      border-color: #667eea;\n    }\n\n    .location-list {\n      display: grid;\n      gap: 1rem;\n    }\n\n    .location-card {\n      padding: 1.5rem;\n      border: 1px solid #e0e0e0;\n      border-radius: 8px;\n      transition: all 0.3s;\n    }\n\n    .location-card:hover {\n      box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n      border-color: #667eea;\n    }\n\n    .location-name {\n      font-size: 1.3rem;\n      font-weight: bold;\n      color: #333;\n      margin-bottom: 0.5rem;\n    }\n\n    .location-meta {\n      display: flex;\n      gap: 1.5rem;\n      margin-bottom: 1rem;\n      font-size: 0.9rem;\n      color: #666;\n    }\n\n    .location-meta span {\n      display: flex;\n      align-items: center;\n      gap: 0.3rem;\n    }\n\n    .domains {\n      display: flex;\n      gap: 0.5rem;\n      flex-wrap: wrap;\n    }\n\n    .domain-tag {\n      padding: 0.3rem 0.8rem;\n      background: #f0f4ff;\n      color: #667eea;\n      border-radius: 15px;\n      font-size: 0.85rem;\n      font-weight: 500;\n    }\n\n    footer {\n      text-align: center;\n      padding: 2rem;\n      color: #666;\n    }\n\n    @media (max-width: 768px) {\n      header h1 {\n        font-size: 1.8rem;\n      }\n\n      .stats {\n        grid-template-columns: repeat(2, 1fr);\n      }\n\n      .location-meta {\n        flex-direction: column;\n        gap: 0.5rem;\n      }\n    }\n  ";
}

function generateStats(report) {
  return "\n    <div class=\"stats\">\n      <div class=\"stat-card\">\n        <div class=\"stat-value\">" + report.totalExperiences.toString() + "</div>\n        <div class=\"stat-label\">Experiences</div>\n      </div>\n      <div class=\"stat-card\">\n        <div class=\"stat-value\">" + report.uniqueLocations.toString() + "</div>\n        <div class=\"stat-label\">Locations</div>\n      </div>\n      <div class=\"stat-card\">\n        <div class=\"stat-value\">" + report.uniqueDomains.toString() + "</div>\n        <div class=\"stat-label\">Domains</div>\n      </div>\n      <div class=\"stat-card\">\n        <div class=\"stat-value\">" + report.uniqueLearners.toString() + "</div>\n        <div class=\"stat-label\">Learners</div>\n      </div>\n    </div>\n  ";
}

function generateHotspotCard(hotspot) {
  var domainTags = hotspot.domains.map(function (d) {
          return "<span class=\"domain-tag\">" + d + "</span>";
        }).join("");
  var domainsAttr = hotspot.domains.join(" ");
  return "\n    <div class=\"location-card\" data-domains=\"" + domainsAttr + "\">\n      <div class=\"location-name\">" + hotspot.location + "</div>\n      <div class=\"location-meta\">\n        <span>üìä " + hotspot.count.toString() + " experiences</span>\n        <span>üë• " + hotspot.learners.toString() + " learners</span>\n        <span>üéØ " + hotspot.diversity.toString() + " diversity</span>\n      </div>\n      <div class=\"domains\">\n        " + domainTags + "\n      </div>\n    </div>\n  ";
}

function generateHotspotsSection(hotspots) {
  var cards = hotspots.map(generateHotspotCard).join("\n");
  return "\n    <div class=\"section\">\n      <h2>üî• Learning Hotspots</h2>\n      <p style=\"margin-bottom: 1rem; color: #666;\">\n        Locations with high disciplinary diversity (" + hotspots.length.toString() + " found)\n      </p>\n\n      <input\n        type=\"text\"\n        class=\"search-bar\"\n        id=\"searchHotspots\"\n        placeholder=\"Search locations, domains, or types...\"\n      />\n\n      <div class=\"filters\" id=\"domainFilters\"></div>\n\n      <div class=\"location-list\" id=\"hotspotsList\">\n        " + cards + "\n      </div>\n    </div>\n  ";
}

function generateGeographicSection(locationsWithCoords) {
  if (locationsWithCoords > 0) {
    return "\n      <div class=\"section\">\n        <h2>üó∫Ô∏è Geographic Distribution</h2>\n        <p style=\"margin-bottom: 1rem; color: #666;\">\n          " + locationsWithCoords.toString() + " locations with GPS coordinates\n        </p>\n        <div style=\"background: #f0f0f0; padding: 2rem; border-radius: 8px; text-align: center;\">\n          <p style=\"color: #666; margin-bottom: 1rem;\">\n            üìç Coordinates available for mapping\n          </p>\n          <p style=\"font-size: 0.9rem; color: #999;\">\n            Export to GeoJSON to visualize in mapping tools:\n            <code style=\"background: white; padding: 0.2rem 0.5rem; border-radius: 3px; color: #667eea;\">\n              deno run --allow-read --allow-write src-rescript/Export.res.js geojson map.json\n            </code>\n          </p>\n        </div>\n      </div>\n    ";
  } else {
    return "";
  }
}

function generateNetworkSection(network) {
  var topDomains = network.nodes.toSorted(function (a, b) {
              return b.size - a.size | 0;
            }).slice(0, 10).map(function (node) {
          return "\n        <div style=\"padding: 0.5rem; background: white; border-radius: 4px; border: 1px solid #e0e0e0;\">\n          <strong>" + node.id + "</strong>: " + node.size.toString() + " experiences\n        </div>\n      ";
        }).join("");
  var strongestConnections = network.edges.toSorted(function (a, b) {
              return b.weight - a.weight | 0;
            }).slice(0, 10).map(function (edge) {
          return "\n        <div style=\"padding: 0.5rem; background: white; border-radius: 4px; border: 1px solid #e0e0e0; display: flex; justify-content: space-between;\">\n          <span>" + edge.source + " ‚Üî " + edge.target + "</span>\n          <strong style=\"color: #667eea;\">" + edge.weight.toString() + "x</strong>\n        </div>\n      ";
        }).join("");
  return "\n    <div class=\"section\">\n      <h2>üï∏Ô∏è Domain Network</h2>\n      <p style=\"margin-bottom: 1rem; color: #666;\">\n        " + network.nodes.length.toString() + " domains, " + network.edges.length.toString() + " connections\n      </p>\n\n      <div style=\"background: #f9f9f9; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;\">\n        <h3 style=\"margin-bottom: 1rem; color: #555;\">Top Domains</h3>\n        <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.5rem;\">\n          " + topDomains + "\n        </div>\n      </div>\n\n      <div style=\"background: #f9f9f9; padding: 1.5rem; border-radius: 8px;\">\n        <h3 style=\"margin-bottom: 1rem; color: #555;\">Strongest Connections</h3>\n        <div style=\"display: grid; gap: 0.5rem;\">\n          " + strongestConnections + "\n        </div>\n      </div>\n\n      <div style=\"margin-top: 1rem; font-size: 0.9rem; color: #999; text-align: center;\">\n        üí° Export to DOT format for graph visualization:\n        <code style=\"background: white; padding: 0.2rem 0.5rem; border-radius: 3px; color: #667eea;\">\n          deno run --allow-read --allow-write src-rescript/Export.res.js dot network.dot\n        </code>\n      </div>\n    </div>\n  ";
}

function generateInsightsSection(report, hotspots) {
  var mostDiverseLocation = hotspots[0];
  var locationName = Core__Option.getOr(Core__Option.map(mostDiverseLocation, (function (h) {
              return h.location;
            })), "N/A");
  var diversity = Core__Option.getOr(Core__Option.map(mostDiverseLocation, (function (h) {
              return h.diversity.toString();
            })), "0");
  var avgDiversity = report.uniqueLocations > 0 ? (report.uniqueDomains / report.uniqueLocations).toString() : "0";
  return "\n    <div class=\"section\">\n      <h2>üí° Insights</h2>\n      <div style=\"display: grid; gap: 1rem;\">\n        <div style=\"padding: 1rem; background: #f0f4ff; border-left: 4px solid #667eea; border-radius: 4px;\">\n          <strong>Most diverse location:</strong>\n          " + locationName + " (" + diversity + " domains)\n        </div>\n        <div style=\"padding: 1rem; background: #f0f4ff; border-left: 4px solid #667eea; border-radius: 4px;\">\n          <strong>Interdisciplinary learning:</strong>\n          " + report.interdisciplinaryExperiences.toString() + " experiences span multiple domains\n        </div>\n        <div style=\"padding: 1rem; background: #f0f4ff; border-left: 4px solid #667eea; border-radius: 4px;\">\n          <strong>Average diversity per location:</strong>\n          " + avgDiversity + " domains\n        </div>\n      </div>\n    </div>\n  ";
}

function generateJavaScript(hotspots) {
  var allDomains = Core__Array.reduce(Core__Array.reduce(hotspots, [], (function (acc, h) {
              return acc.concat(h.domains);
            })), [], (function (acc, d) {
          if (acc.includes(d)) {
            return acc;
          } else {
            return acc.concat([d]);
          }
        }));
  var json = JSON.stringify(allDomains);
  var domainsJSON = json !== undefined ? json : "[]";
  return "\n    // Search functionality\n    const searchBar = document.getElementById('searchHotspots');\n    const cards = document.querySelectorAll('.location-card');\n\n    searchBar.addEventListener('input', (e) => {\n      const query = e.target.value.toLowerCase();\n\n      cards.forEach(card => {\n        const text = card.textContent.toLowerCase();\n        card.style.display = text.includes(query) ? 'block' : 'none';\n      });\n    });\n\n    // Domain filters\n    const allDomains = " + domainsJSON + ";\n    const filtersContainer = document.getElementById('domainFilters');\n    let activeDomains = new Set();\n\n    allDomains.forEach(domain => {\n      const tag = document.createElement('div');\n      tag.className = 'filter-tag';\n      tag.textContent = domain;\n      tag.addEventListener('click', () => {\n        tag.classList.toggle('active');\n\n        if (tag.classList.contains('active')) {\n          activeDomains.add(domain);\n        } else {\n          activeDomains.delete(domain);\n        }\n\n        filterCards();\n      });\n\n      filtersContainer.appendChild(tag);\n    });\n\n    function filterCards() {\n      if (activeDomains.size === 0) {\n        cards.forEach(card => card.style.display = 'block');\n        return;\n      }\n\n      cards.forEach(card => {\n        const cardDomains = card.dataset.domains.split(' ');\n        const hasActiveDomain = cardDomains.some(d => activeDomains.has(d));\n        card.style.display = hasActiveDomain ? 'block' : 'none';\n      });\n    }\n  ";
}

function generateHTML(report, hotspots, network, locationsWithCoords) {
  var currentDate = new Date().toLocaleDateString();
  return "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>UbiCity Learning Map</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      background: #f5f5f5;\n      color: #333;\n    }\n\n    header {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 2rem;\n      text-align: center;\n      box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n    }\n\n    header h1 {\n      font-size: 2.5rem;\n      margin-bottom: 0.5rem;\n    }\n\n    header p {\n      opacity: 0.9;\n      font-size: 1.1rem;\n    }\n\n    .container {\n      max-width: 1200px;\n      margin: 2rem auto;\n      padding: 0 1rem;\n    }\n\n    .stats {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n      gap: 1rem;\n      margin-bottom: 2rem;\n    }\n\n    .stat-card {\n      background: white;\n      padding: 1.5rem;\n      border-radius: 8px;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      text-align: center;\n    }\n\n    .stat-value {\n      font-size: 2.5rem;\n      font-weight: bold;\n      color: #667eea;\n      margin-bottom: 0.5rem;\n    }\n\n    .stat-label {\n      color: #666;\n      font-size: 0.9rem;\n      text-transform: uppercase;\n      letter-spacing: 0.5px;\n    }\n\n    .section {\n      background: white;\n      border-radius: 8px;\n      padding: 2rem;\n      margin-bottom: 2rem;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n    }\n\n    .section h2 {\n      color: #667eea;\n      margin-bottom: 1.5rem;\n      font-size: 1.8rem;\n    }\n\n    .search-bar {\n      width: 100%;\n      padding: 0.75rem;\n      font-size: 1rem;\n      border: 2px solid #ddd;\n      border-radius: 4px;\n      margin-bottom: 1rem;\n      transition: border-color 0.3s;\n    }\n\n    .search-bar:focus {\n      outline: none;\n      border-color: #667eea;\n    }\n\n    .filters {\n      display: flex;\n      gap: 0.5rem;\n      flex-wrap: wrap;\n      margin-bottom: 1rem;\n    }\n\n    .filter-tag {\n      padding: 0.5rem 1rem;\n      background: #f0f0f0;\n      border: 1px solid #ddd;\n      border-radius: 20px;\n      cursor: pointer;\n      transition: all 0.3s;\n      font-size: 0.9rem;\n    }\n\n    .filter-tag:hover {\n      background: #e0e0e0;\n    }\n\n    .filter-tag.active {\n      background: #667eea;\n      color: white;\n      border-color: #667eea;\n    }\n\n    .location-list {\n      display: grid;\n      gap: 1rem;\n    }\n\n    .location-card {\n      padding: 1.5rem;\n      border: 1px solid #e0e0e0;\n      border-radius: 8px;\n      transition: all 0.3s;\n    }\n\n    .location-card:hover {\n      box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n      border-color: #667eea;\n    }\n\n    .location-name {\n      font-size: 1.3rem;\n      font-weight: bold;\n      color: #333;\n      margin-bottom: 0.5rem;\n    }\n\n    .location-meta {\n      display: flex;\n      gap: 1.5rem;\n      margin-bottom: 1rem;\n      font-size: 0.9rem;\n      color: #666;\n    }\n\n    .location-meta span {\n      display: flex;\n      align-items: center;\n      gap: 0.3rem;\n    }\n\n    .domains {\n      display: flex;\n      gap: 0.5rem;\n      flex-wrap: wrap;\n    }\n\n    .domain-tag {\n      padding: 0.3rem 0.8rem;\n      background: #f0f4ff;\n      color: #667eea;\n      border-radius: 15px;\n      font-size: 0.85rem;\n      font-weight: 500;\n    }\n\n    footer {\n      text-align: center;\n      padding: 2rem;\n      color: #666;\n    }\n\n    @media (max-width: 768px) {\n      header h1 {\n        font-size: 1.8rem;\n      }\n\n      .stats {\n        grid-template-columns: repeat(2, 1fr);\n      }\n\n      .location-meta {\n        flex-direction: column;\n        gap: 0.5rem;\n      }\n    }\n  </style>\n</head>\n<body>\n  <header>\n    <h1>üèôÔ∏è UbiCity Learning Map</h1>\n    <p>Mapping informal learning across urban space</p>\n    <p style=\"font-size: 0.9rem; margin-top: 0.5rem;\">\n      Generated: " + currentDate + "\n    </p>\n  </header>\n\n  <div class=\"container\">\n    " + generateStats(report) + "\n    " + generateHotspotsSection(hotspots) + "\n    " + generateGeographicSection(locationsWithCoords) + "\n    " + generateNetworkSection(network) + "\n    " + generateInsightsSection(report, hotspots) + "\n  </div>\n\n  <footer>\n    <p>Generated by UbiCity Learning Capture System</p>\n    <p style=\"font-size: 0.9rem; margin-top: 0.5rem;\">\n      <a href=\"https://github.com/Hyperpolymath/ubicity\" style=\"color: #667eea;\">\n        GitHub Repository\n      </a>\n    </p>\n  </footer>\n\n  <script>" + generateJavaScript(hotspots) + "</script>\n</body>\n</html>";
}

async function generateVisualization(mapper, options) {
  var opts = Core__Option.getOr(options, defaultOptions);
  var loadResult = await Mapper.loadAll(mapper);
  if (loadResult.TAG !== "Ok") {
    return Promise.resolve({
                TAG: "Error",
                _0: "Failed to load experiences: " + loadResult._0
              });
  }
  var reportResult = await Mapper.generateReport(mapper);
  if (reportResult.TAG !== "Ok") {
    return Promise.resolve({
                TAG: "Error",
                _0: "Failed to generate report: " + reportResult._0
              });
  }
  var report = reportResult._0;
  var locationMap = Mapper.mapByLocation(mapper);
  var locationsWithCoords = Object.entries(locationMap).filter(function (param) {
        return Core__Option.isSome(param[1].coordinates);
      }).length;
  var network = Mapper.generateDomainNetwork(mapper);
  var html = generateHTML(report.summary, report.learningHotspots, network, locationsWithCoords);
  return Core__Promise.$$catch(mapper.storage.saveVisualization(html, opts.outputFile).then(function (_filepath) {
                  return Promise.resolve({
                              TAG: "Ok",
                              _0: opts.outputFile
                            });
                }), (function (_err) {
                return Promise.resolve({
                            TAG: "Error",
                            _0: "Failed to save visualization"
                          });
              }));
}

export {
  defaultOptions ,
  generateCSS ,
  generateStats ,
  generateHotspotCard ,
  generateHotspotsSection ,
  generateGeographicSection ,
  generateNetworkSection ,
  generateInsightsSection ,
  generateJavaScript ,
  generateHTML ,
  generateVisualization ,
}
/* Mapper Not a pure module */
